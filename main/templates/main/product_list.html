{% extends 'main/base.html' %}

{% block title %}Товары{% endblock %}

{% block content %}
<section class="product-section">
    <h1>Каталог кремов для загара</h1>
    <div class="filters">
        <select onchange="window.location.href=this.value">
            <option value="?">Все категории</option>
            {% for category in categories %}
            <option value="?category={{ category.name }}"
                    {% if request.GET.category == category.name %}selected{% endif %}>
                {{ category.name }}
            </option>
            {% endfor %}
        </select>
    
        <select onchange="window.location.href=this.value">
            <option value="">Сортировать по</option>
            <option value="?sort_by=price">Цена (возрастание)</option>
            <option value="?sort_by=-price">Цена (убывание)</option>
            <option value="?sort_by=name">Название</option>
        </select>
    </div>
    <div class="product-list">
        {% for product in products %}
        <div class="product-item">
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
            <h2 class="product-title">{{ product.name }}</h2>
            <p class="product-description">
                {{ product.description|truncatewords:20 }}
                <a href="#" class="toggle-description" data-bs-toggle="modal" data-bs-target="#productDetailModal" data-title="{{ product.name }}" data-description="{{ product.description }}">Показать больше</a>
            </p>
            
            <p class="product-price">Цена: {{ product.price }} руб.</p>
            <button class="product-buy-button">Купить</button>
        </div>
        {% empty %}
        <p>Продукты не найдены.</p>
        {% endfor %}
    </div>
</section>

<!-- Модальное окно для детального просмотра продукта -->
<div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailModalLabel">Детали продукта</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Содержимое модального окна -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Добавить в корзину</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block script %}
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
  // Инициализация Swiper и другие скрипты, если они у вас есть

  // Скрипт для управления модальным окном
  document.addEventListener("DOMContentLoaded", function() {
  // Ссылки "Показать больше", которые должны открывать модальное окно
  document.querySelectorAll('.toggle-description').forEach(function(link) {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Извлечение данных о продукте из data-атрибутов
      var productTitle = this.getAttribute('data-title');
      var productDescription = this.getAttribute('data-description');
      
      // Заполнение модального окна данными
      var modalTitle = document.querySelector('#productDetailModal .modal-title');
      var modalBody = document.querySelector('#productDetailModal .modal-body');
      
      modalTitle.textContent = productTitle;
      modalBody.innerHTML = productDescription;
      
      // Отображение модального окна
      $('#productDetailModal').modal('show');
    });
  });
});
</script>
{% endblock %}
